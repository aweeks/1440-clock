<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <title>1440 Clock</title>

        <link rel="shortcut icon" href="favicon.ico" />
        <link
            href="https://fonts.googleapis.com/css?family=Source+Code+Pro:100,400,700&display=swap"
            rel="stylesheet"
        />

        <style>
            body {
                background-color: black;
                color: white;
                font-family: 'Source Code Pro', monospace;
                letter-spacing: 2px;
                margin: 0px;
            }
            .hour-prog-bar-wrap {
                margin-bottom: 0px;
                width: 100%;
            }
            .hour-prog-bar-wrap .hour-prog-bar-label {
                float: left;
                font-size: 10pt;
                margin-left: 10px;
                margin-top: 5px;
                text-align: left;
            }
            .hour-prog-bar-wrap .hour-prog-bar {
                background-color: #0e3a5c;
                width: 100%;
            }
            .hour-prog-bar-wrap .hour-prog-bar-fill-complete {
                background-color: black; /* #346388 */
                height: 30px;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div id="clock"></div>
        <script>
            // Config ----------------------------------------------------------

            const d = document;
            const w = window;

            const HOURS_IN_DAY = 24;
            const MINS_IN_HOUR = 60;
            const SECS_IN_MIN = 60;
            const MS_IN_SECS = 1000;
            const DISPLAY_UPDATE_INTERVAL = 100;

            // Vertical spacing variables (in px). See the CSS.
            const BODY_VERT_MARGIN_HEIGHT = 0;
            const HOUR_BAR_VERT_MARGIN_HEIGHT = 0;
            const MIN_VIEWPORT_HEIGHT_PX = 575; // Hand-tuned

            // User settings ---------------------------------------------------

            // Gather user settings from the query string
            const getIntQuerySetting = (key, defaultVal = 0) => {
                const val = location.search.match(
                    new RegExp(`\\b(${key})=(\\d+)\\b`),
                    'i',
                );
                return val ? parseInt(val)[2] : defaultVal;
            };

            // Starting hour, default 0
            const START_HOUR = getIntQuerySetting('sh');

            // Starting minute, default 0
            const START_MINUTE = getIntQuerySetting('sm');

            // How many hours to show. Can be used to show partial days, e.g.,
            // working hours. Defaults to 24.
            const HOURS_TO_DISPLAY = getIntQuerySetting('dh', HOURS_IN_DAY);

            // Helper functions ------------------------------------------------

            // Prefix targetNum with zeros up to the specified digits
            const zeroPad = (targetNum, digits = 2) =>
                '0'.repeat(digits - String(targetNum).length) + targetNum;

            // Clock -----------------------------------------------------------

            // Create the HTML for a single hour progress bar
            const createHourBar = hour => {
                // Create the progress bar filler
                const hourProgBarFill = d.createElement('div');
                hourProgBarFill.className = 'hour-prog-bar-fill-complete';

                // Create the progress bar itself, append the filler
                const hourProgBar = d.createElement('div');
                hourProgBar.className = 'hour-prog-bar';
                hourProgBar.appendChild(hourProgBarFill);

                // Create the label with the hour
                const hourProgBarLabel = d.createElement('div');
                hourProgBarLabel.className = 'hour-prog-bar-label';
                hourProgBarLabel.innerText = zeroPad(hour);

                // Create the hour's wrapper, append the label and prog bar
                const hourProgBarWrap = d.createElement('div');
                hourProgBarWrap.id = 'hour-' + zeroPad(hour);
                hourProgBarWrap.className = 'hour-prog-bar-wrap';
                hourProgBarWrap.appendChild(hourProgBarLabel);
                hourProgBarWrap.appendChild(hourProgBar);

                return hourProgBarWrap;
            };

            // Generate the clock HTML and add it to the DOM
            const generateClock = targetElQuery => {
                const targetEl = d.querySelector(targetElQuery);
                for (let h = 0; h < HOURS_IN_DAY; ++h) {
                    targetEl.appendChild(createHourBar(h));
                }
            };

            // Update the clock
            const updateClock = date => {
                // Break up the current time
                const hours =
                    (date.getHours() + HOURS_IN_DAY - START_HOUR) %
                    HOURS_IN_DAY;
                const mins =
                    (date.getMinutes() + MINS_IN_HOUR - START_MINUTE) %
                    MINS_IN_HOUR;
                const secs = date.getSeconds();
                const ms = date.getMilliseconds();

                for (let h = 0; h < HOURS_IN_DAY; ++h) {
                    const hourProgBarFill = d.querySelector(
                        `#hour-${zeroPad(h)} .hour-prog-bar-fill-complete`,
                    );
                    const hourProgBarLabel = d.querySelector(
                        `#hour-${zeroPad(h)} .hour-prog-bar-label`,
                    );

                    // Past - Start by assuming the hour's 100% over
                    if (h < hours) {
                        hourProgBarFill.style.width = '100%';

                        hourProgBarLabel.innerText = zeroPad(h);
                        hourProgBarLabel.style.color = 'darkgrey';
                        hourProgBarLabel.style.fontWeight = '100';
                    }

                    // Present - If it's the current hour, calculate the percent
                    // of the hour that's complete
                    else if (h === hours) {
                        const fractionOfSec = ms / MS_IN_SECS;
                        const fractionOfMin =
                            (secs + fractionOfSec) / SECS_IN_MIN;
                        const fractionOfHour =
                            (mins + fractionOfMin) / MINS_IN_HOUR;
                        const tenthOfSec = Math.floor(ms / 100);
                        const percentHourOver = fractionOfHour * 100;

                        hourProgBarFill.style.width = percentHourOver + '%';

                        // Set the label to the current time
                        hourProgBarLabel.innerText = `${zeroPad(h)}:${zeroPad(
                            mins,
                        )}:${zeroPad(secs)}.${tenthOfSec}`;
                        hourProgBarLabel.style.color = 'white';

                        if (tenthOfSec === 0) {
                            hourProgBarLabel.style.fontWeight = '700';
                            // hourProgBarLabel.style.textDecoration = 'underline';
                        } else {
                            hourProgBarLabel.style.fontWeight = '400';
                            // hourProgBarLabel.style.textDecoration = 'none';
                        }
                    }

                    // Future - If it's a future hour, it's completely full
                    else if (h > hours) {
                        hourProgBarFill.style.width = '0';

                        hourProgBarLabel.innerText = zeroPad(h);
                        hourProgBarLabel.style.color = 'lightgrey';
                        hourProgBarLabel.style.fontWeight = '400';
                    }

                    // Set the bar height such that the clock height completely
                    // fills the screen respecting minimum height
                    const viewportHeight =
                        w.innerHeight > MIN_VIEWPORT_HEIGHT_PX
                            ? w.innerHeight
                            : MIN_VIEWPORT_HEIGHT_PX;
                    hourProgBarFill.style.height =
                        (viewportHeight -
                            BODY_VERT_MARGIN_HEIGHT -
                            HOURS_IN_DAY * HOUR_BAR_VERT_MARGIN_HEIGHT) /
                        HOURS_IN_DAY;
                }
            };

            // Main ------------------------------------------------------------

            // Generate clock HTML
            generateClock('#clock');

            // Update display immediately, then at a regular interval
            const updateDisplay = () => {
                const date = new Date();
                updateClock(date);
            };
            updateDisplay();
            setInterval(
                requestAnimationFrame.bind(this, updateDisplay),
                DISPLAY_UPDATE_INTERVAL,
            );
        </script>
    </body>
</html>
