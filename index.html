<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            body {
                background-color: black;
                color: white;
                font-family: 'Lucida Console', 'Courier', monospace;
            }
        </style>
    </head>

    <body>
        <pre id="datetime"></pre>
        <pre id="clock"></pre>
    </body>
    <script>
        // Symbols to represent a minute, past, present, and future
        const MINUTE_SYM = {
            PAST: '.  ', // 'â¬› ',
            FUTURE: '#  ', // 'â¬œ ',
            PRESENT: 'X  ', // 'ðŸ”² ',
        };

        // What time to start the clock display (bedtime for me)
        const START_HOUR = 21;

        // How often to update the display in milliseconds
        const DISPLAY_UPDATE_INTERVAL = 200;

        // Just in case we ever switch to metric time ;-)
        const HOURS_IN_DAY = 24;
        const MINS_IN_HOUR = 60;

        // Prefix targetNum with zeros up to the specified digits
        const zeroPad = (targetNum, digits) =>
            '0'.repeat(digits - String(targetNum).length) + targetNum;

        // Return a formatted date-time string for display
        const getFormattedDateTime = () => {
            const d = new Date();
            const year = d.getFullYear();
            const month = zeroPad(d.getMonth(), 2);
            const day = zeroPad(d.getDay(), 2);
            const hour = zeroPad(d.getHours(), 2);
            const min = zeroPad(d.getMinutes(), 2);
            const sec = zeroPad(d.getSeconds(), 2);
            const ms = zeroPad(d.getMilliseconds(), 3);
            const tzhour = Math.floor(d.getTimezoneOffset() / 60);
            const tzmin = zeroPad(
                Math.abs(tzhour * 60 - d.getTimezoneOffset()),
                2,
            );

            return `${year}-${month}-${day} ${hour}:${min}:${sec}:${ms} (UTC${
                tzhour < 0 ? '+' + tzhour : '-' + tzhour
            }:${tzmin})`;
        };

        // Display the clock matrix. Hours horizontally, minutes vertically.
        const printClockMatrix = cm => {
            let clockString = '    ';

            // Hours labels
            for (let i = 0; i < HOURS_IN_DAY; ++i) {
                const shiftedHours = (i + START_HOUR) % HOURS_IN_DAY;
                clockString += zeroPad(shiftedHours, 2) + ' ';
            }

            clockString += '\n';

            for (let mins = 0; mins < MINS_IN_HOUR; ++mins) {
                clockString += zeroPad(mins, 2) + '  ';

                for (let hours = 0; hours < HOURS_IN_DAY; ++hours) {
                    clockString += cm[hours][mins];
                }

                clockString += '\n';
            }

            return clockString;
        };

        // Generate a clock matrix for the current date
        const generateClockMatrix = date => {
            const hours =
                (date.getHours() + HOURS_IN_DAY - START_HOUR) % HOURS_IN_DAY;
            const mins = date.getMinutes();

            // Clock matrix. row:column -> hour:minute
            const clockMatrix = new Array(HOURS_IN_DAY);

            for (let h = 0; h < HOURS_IN_DAY; ++h) {
                clockMatrix[h] = new Array(MINS_IN_HOUR);

                for (let m = 0; m < MINS_IN_HOUR; ++m) {
                    // Past
                    if (h < hours || (h === hours && m < mins)) {
                        clockMatrix[h][m] = MINUTE_SYM.PAST;
                    }

                    // Present
                    else if (h === hours && m === mins) {
                        clockMatrix[h][m] = MINUTE_SYM.PRESENT;
                    }

                    // Future
                    else if (h > hours || (h === hours && m > mins)) {
                        clockMatrix[h][m] = MINUTE_SYM.FUTURE;
                    }
                }
            }

            return clockMatrix;
        };

        // Update datetime
        const updateDatetime = () => {
            document.querySelector(
                '#datetime',
            ).innerHTML = getFormattedDateTime();
        };
        updateDatetime();

        // Update matrix clock
        const updateClock = () => {
            const clockMatrix = generateClockMatrix(new Date());
            document.querySelector('#clock').innerHTML = printClockMatrix(
                clockMatrix,
            );
        };
        updateClock();

        // Update display at a regular interval
        setInterval(() => {
            updateDatetime();
            updateClock();
        }, DISPLAY_UPDATE_INTERVAL);
    </script>
</html>
